{% extends "layout/base.html" %}
{% load static %}

{% block title %}Cadastrar Loja{% endblock title %}

{% block head %}
    

{% endblock head %}



{% block content %}

<div>
    <div class="pt-[100px] text-center justify-self-center justify-center items-center">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white md:text-4xl">Informações da Loja</h2>
        <div class="justify-center mt-10 ">            
            <label for="company_document_number" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">CNPJ</label>
            <input type="text" 
                placeholder="00.000.000/000-00"
                name="company_document_number" 
                id="company_document_number" 
                class="text-center bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 
                    w-100 p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
            <div class="mt-5">
                <input type="checkbox" name="manual" id="manual" class="form-checkbox">
                <label for="terms" class="ml-2 text-sm text-gray-900 dark:text-white">Inserir dados manualmente.</label>
            </div>
        </div>
    </div>
    
      
    <form method="POST">  
        {% csrf_token %}   
        <input type="hidden" name="company_document_number" id="company_document_number1">   
        <input type="hidden" name="email" id="email" value="{{ supplier.email }}">   
        <input type="hidden" name="phone" id="phone" value="{{ supplier.phone }}">   
        <div class="hidden lg:mt-0 lg:col-span-5 lg:flex gap-8 justify-center">            
            <div id='#address' class="w-full max-w-md py-10 ">
                <div class="space-y-6 bg-white dark:bg-gray-800 border p-5 border-gray-200 rounded-lg shadow-sm dark:border-gray-700">
                    <div>
                        <label for="postal_code" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cep</label>
                        <input type="text" 
                            placeholder="00.000-000"
                            name="postal_code" 
                            id="postal_code"  
                            disabled                          
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                    </div>
                             
                    <div>
                        <label for="street" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Logradouro</label>
                        <input type="text" 
                            placeholder="Logradouro"
                            name="street" 
                            id="street" 
                            disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                    </div>
                    <div class="flex flex-wrap -mx-3 mb-6">
                        <div class="w-full md:w-1/3 px-3 mb-6 md:mb-0">
                            <label for="number" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Número</label>
                            <input type="text" 
                                placeholder="Número"
                                name="number" 
                                id="number" 
                                disabled
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        <div class="w-full md:w-2/3 px-3">
                            <label for="complement" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Complemento</label>
                            <input type="text" 
                                placeholder="Complemento"
                                name="complement" 
                                id="complement" 
                                disabled
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                    </div>
                    <div>
                        <label for="neighborhood" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Bairro</label>
                        <input type="text" 
                            placeholder="Bairro"
                            name="neighborhood" 
                            id="neighborhood" 
                            disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                    </div>
                    <div class="flex flex-wrap -mx-3 mb-6">
                        <div class="w-full md:w-2/3 px-3 mb-6 md:mb-0">
                            <label for="city" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cidade</label>
                            <input type="text" 
                                placeholder=""
                                name="city" 
                                id="city" 
                                disabled
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        <div class="w-full md:w-1/3 px-3">
                            <label for="state" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Estado</label>
                            <input type="text" 
                                placeholder=""
                                name="state" 
                                id="state" 
                                disabled
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                    </div>   
                </div>    
            </div>
            <div class="w-full max-w-md py-10">
                <div class="space-y-6 bg-white dark:bg-gray-800 border p-5 border-gray-200 rounded-lg shadow-sm dark:border-gray-700">
                    <div>
                        <label for="company_name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Razão Social</label>
                        <input type="text" 
                            placeholder="Informe o CNPJ"
                            name="company_name" 
                            id="company_name" 
                            disabled
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                    </div>
                    <div>
                        <label for="company_phone" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Telefone da Loja (com DDD)</label>
                        <input type="text" 
                            placeholder="(00) 00000-0000"
                            name="company_phone" 
                            id="company_phone"   
                            disabled                              
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                    </div>
                    
                    <div>
                        <label for="company_name_show" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nome da Loja no Aplicativo</label>
                        <input type="text" 
                            placeholder="Nome da Loja no Aplicativo"
                            name="company_name_show" 
                            id="company_name_show"                             
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                    </div>
                    <div>
                        <label for="owner_name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Responsável da Loja</label>
                        <input type="text" 
                            placeholder="Bernardo Tadeu"
                            name="owner_name" 
                            id="owner_name" 
                            disabled                            
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" value="{{supplier.owner_name}}" required>
                    </div>

                    <div class="flex flex-wrap -mx-3 mb-6">
                        <div class="w-full md:w-1/2 px-3 mb-6 md:mb-0">
                            <label for="owner_document_number" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">CPF</label>
                            <input type="text" 
                                placeholder="000.000.000-00"
                                name="owner_document_number" 
                                id="owner_document_number"                             
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        <div class="w-full md:w-1/2 px-3">
                            <label for="password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Senha de Acesso</label>
                            <input type="password" 
                                placeholder="********"
                                name="password" 
                                id="password"                             
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                    </div>
                </div>
            </div>
            {% for error in errors %}
                </div>      
                    {{ error }}
                <div>
            {% endfor %}

        </div>
        <div class="text-center">                
            <button type="submit" class="text-white bg-purple-600 hover:bg-purple-700 focus:ring-4 focus:ring-purple-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900">
                <div class="flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                    </svg>
                    <span>&nbsp&nbsp&nbsp&nbsp Continuar </span>
                </div>
            </button>  
        </div>
    </form>
</div>


{% endblock content %}

{% block javascript %}
<script src="{% static 'js/jquery.mask.min.js' %}"></script>
<script>    
    $(document).ready(function() {
        $('#postal_code').mask('00.000-000');
        $('#phone').mask('(00) 00000-0000');
        $('#company_phone').mask('(00) 00000-0000');
        $('#company_document_number').mask('00.000.000/0000-00');
        $('#owner_document_number').mask('000.000.000-00');
        $('#company_document_number').css('border-color', '#5F76DE').css('background-color', '#E1E7FE').focus();
    });  

    $('#manual').on('click', function() {
        if ($(this).is(':checked')) {
            $('input[type="text"]')
                .not($('#company_document_number'))
                .not($('#company_name'))
                .each(function() {
                $(this).prop('disabled', false).css('border-color', '#6F7683').val('');
            });
        } else {
            $('input[type="text"]')
            .not($('#company_document_number'))
                .not($('#company_phone'))
                .not($('#company_name'))
                .not($('#company_name_show'))
                .not($('#owner_document_number'))
                .each(function() {
                $(this).prop('disabled', true).css('border-color', '#D1D5DB').val('');
            });
        }
    });

    $('#company_document_number').on('keyup', function() {
        if ($(this).val().length < 18) return false;       
        
        var company_document_number = $(this).val().replace(/\D/g,'');
        
        $.ajax({
            url: "{% url 'supplier:get_company_from_document' %}",
            type: "GET",
            data: {
                'company_document_number': company_document_number
            },
            dataType: "json",
            async: false,
            success: function(data) {    
                
                $('#postal_code').val(data['cep']);
                $('#street').val(data['logradouro']);
                $('#number').val(data['numero']);
                $('#complement').val(data['complemento']);
                $('#neighborhood').val(data['bairro']);
                $('#city').val(data['municipio']);
                $('#state').val(data['uf']);
                //$('#owner_name').val({{supplier.owner_name}});

                $('#company_name').val(data['nome']); 
                $('#company_phone').val(data['telefone']);  
                $('#company_name_show').val(data['fantasia']).focus();
            },
            error: function() {
                alert('Informe um Cnpj Válido.');
            }
        });
    });

    $('#postal_code').on('keyup', function() {        
        if ($(this).val().length < 10) return false; 
        if ($('#manual').is(':checked')) {
            var postal_code = $(this).val().replace(/\D/g,'');
            
            $.ajax({
                url: "{% url 'supplier:get_address_from_postal_code' %}",
                type: "GET",
                data: {
                    'postal_code': postal_code
                },
                dataType: "json",
                async: false,
                success: function(data) {    
                    
                    $('#street').val(data['street']);
                    $('#neighborhood').val(data['neighborhood']);
                    $('#city').val(data['city']);
                    $('#state').val(data['state']);
                    $('#number').focus();
                },
                error: function() {
                    alert('Informe um Cnpj Válido.');
                }
            });
        }
    });

    $('form').submit(function(e){
        $('input#company_document_number1').val($('input#company_document_number').val());
        $('input[type="text"]').removeAttr('disabled');
    });



    
</script>
{% endblock javascript %}