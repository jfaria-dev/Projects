{% extends "layout/base.html" %}
{% load static %}

{% block title %}Cadastrar Loja{% endblock title %}

{% block head %}{% endblock head %}

{% block content %}
    <div>
        <div class="pt-[100px] text-center justify-self-center justify-center items-center">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white md:text-4xl">Cadastro de Informações</h2>
            <div class="justify-center mt-10 ">   
                <div>         
                    <label for="company_document_number" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">CPF</label>
                    <input type="text" 
                        placeholder="000.000.000-00"
                        name="company_document_number" 
                        id="company_document_number" 
                        class="text-center bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 
                            w-100 p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                </div>
                <div >                
                    <label for="professional_birthdate" class="pt-5 block mb-2 text-sm font-medium text-gray-900 dark:text-white">Data de Nascimento</label>
                    <input type="date" 
                        placeholder="DD/MM/AAAA"
                        name="professional_birthdate" 
                        id="professional_birthdate" 
                        class="text-center bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 
                            w-100 p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                </div>
            </div>
        </div>
        
        
        <form>   
            {% csrf_token %}
            <input type="hidden" name="company_document_number" id="company_document_number1">   
            <input type="hidden" name="professional_birthdate" id="professional_birthdate1">   
            <input type="hidden" name="email" id="email" value="{{ supplier.email }}">   
            <input type="hidden" name="phone" id="phone" value="{{ supplier.phone }}">      
            <div class="hidden lg:mt-0 lg:col-span-5 lg:flex gap-8 justify-center">            
                <div class="w-full max-w-md py-10 ">
                    <div class="space-y-6 bg-white dark:bg-gray-800 border p-5 border-gray-200 rounded-lg shadow-sm dark:border-gray-700">
                        <div>
                            <label for="service_name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cep</label>
                            <input type="text" 
                                placeholder="00.000-000"
                                name="postal_code" 
                                id="postal_code"                         
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                                
                        <div>
                            <label for="service_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Logradouro</label>
                            <input type="text" 
                                placeholder="Logradouro"
                                name="street" 
                                id="street" 
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        <div class="flex flex-wrap -mx-3 mb-6">
                            <div class="w-full md:w-1/3 px-3 mb-6 md:mb-0">
                                <label for="service_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Número</label>
                                <input type="text" 
                                    placeholder="Número"
                                    name="number" 
                                    id="number" 
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                        w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                            </div>
                            <div class="w-full md:w-2/3 px-3">
                                <label for="service_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Complemento</label>
                                <input type="text" 
                                    placeholder="Complemento"
                                    name="complement" 
                                    id="complement" 
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                        w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label for="service_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Bairro</label>
                            <input type="text" 
                                placeholder="Bairro"
                                name="neighborhood" 
                                id="neighborhood" 
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        <div class="flex flex-wrap -mx-3 mb-6">
                            <div class="w-full md:w-2/3 px-3 mb-6 md:mb-0">
                                <label for="service_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Cidade</label>
                                <input type="text" 
                                    placeholder=""
                                    name="city" 
                                    id="city" 
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                        w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                            </div>
                            <div class="w-full md:w-1/3 px-3">
                                <label for="service_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Estado</label>
                                <input type="text" 
                                    placeholder=""
                                    name="state" 
                                    id="state" 
                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                        w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                            </div>
                        </div>   
                    </div>    
                </div>
                <div class="w-full max-w-md py-10">
                    <div class="space-y-6 bg-white dark:bg-gray-800 border p-5 border-gray-200 rounded-lg shadow-sm dark:border-gray-700">
                        <div>
                            <label for="service_description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nome Profissional</label>
                            <input type="text" 
                                placeholder="Informe o CPF"
                                name="company_name" 
                                id="company_name" 
                                disabled
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        <div>
                            <label for="service_category" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Telefone da Loja (com DDD)</label>
                            <input type="text" 
                                placeholder="(00) 00000-0000"
                                name="company_phone" 
                                id="company_phone"                       
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        
                        <div>
                            <label for="service_name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nome Profissional no Aplicativo</label>
                            <input type="text" 
                                placeholder="Nome da Loja no Aplicativo"
                                name="company_name_show" 
                                id="company_name_show"                             
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block 
                                    w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white" required>
                        </div>
                        
                    </div>
                </div>
            </div>      
            <div class="text-center">                
                <button type="submit" class="text-white bg-purple-600 hover:bg-purple-700 focus:ring-4 focus:ring-purple-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900">
                    <div class="flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" />
                        </svg>
                        <span>&nbsp&nbsp&nbsp&nbsp Continuar </span>
                    </div>
                </button>  
            </div>
        </form>
    </div>
{% endblock content %}

{% block javascript %}
<script src="{% static 'js/jquery.mask.min.js' %}"></script>
<script>
    function isDateValid(dateStr) {
        return !isNaN(new Date(dateStr));
    }

    $(document).ready(function() {
        $('#postal_code').mask('00.000-000');
        $('#company_phone').mask('(00) 00000-0000');
        $('#company_document_number').mask('000.000.000-00');
        $('#company_document_number').focus();
    });

    $('#company_document_number').on('keyup', function() {
        if ($('#company_document_number').val().length == 14) $('#professional_birthdate').focus();
    });

    $('#professional_birthdate').on('keyup', function() {
        if (!isDateValid($('#professional_birthdate').val())) return false;
        if ($('#professional_birthdate').val().split('-')[0] < 1940 || $('#professional_birthdate').val().split('-')[0] > 2100) return false;
        if ($('#company_document_number').val().length < 14) return false;
        
        var company_document_number = $('#company_document_number').val().replace(/\D/g,'');
        
        $.ajax({
            url: "{% url 'supplier:get_professional_from_document' %}",
            type: "GET",
            data: {
                'company_document_number': company_document_number,
                'professional_birthdate': $('#professional_birthdate').val()
            },
            dataType: "json",
            async: false,
            success: function(data) {  
                $('#company_name').val(data['nome']);
                $('#postal_code').focus();
            },
            error: function() {
                alert('Informe um CPF e Data de Nascimento Válido.');
            }
        });
    });

    $('#postal_code').on('keyup', function() {        
        if ($(this).val().length < 10) return false; 
        var postal_code = $(this).val().replace(/\D/g,'');
        
        $.ajax({
            url: "{% url 'supplier:get_address_from_postal_code' %}",
            type: "GET",
            data: {
                'postal_code': postal_code
            },
            dataType: "json",
            async: false,
            success: function(data) {    
                if (data['street']) {
                    $('#street').val(data['street']).attr('disabled', true);
                    $('#neighborhood').val(data['neighborhood']).attr('disabled', true);
                    $('#city').val(data['city']).attr('disabled', true);
                    $('#state').val(data['state']).attr('disabled', true);
                    $('#number').focus();
                }else{
                    alert('CEP não encontrado.');
                    $('#street').val('').attr('disabled', false);
                    $('#neighborhood').val('').attr('disabled', false);
                    $('#city').val('').attr('disabled', false);
                    $('#state').val('').attr('disabled', false);
                    $('#postal_code').focus();
                }
            },
            error: function() {
                alert('CEP não encontrado.');
                $('#street').val('').attr('disabled', false);
                $('#neighborhood').val('').attr('disabled', false);
                $('#city').val('').attr('disabled', false);
                $('#state').val('').attr('disabled', false);
                $('#postal_code').focus();
            }
        });
    });

    
</script>
{% endblock javascript %}